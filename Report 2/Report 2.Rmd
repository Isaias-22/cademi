---
title: Course title
subtitle: Lecture title
author:
  name: Your name
  affiliation: University | Course code
# date: "`r format(Sys.time(), '%d %B %Y')`" ## Or "Lecture no."
output: 
  html_document:
    theme: flatly
    highlight: haddock
    # code_folding: show
    toc: yes
    toc_depth: 4
    toc_float: yes
    keep_md: false
    keep_tex: false ## Change to true if want keep intermediate .tex file
    css: preamble.css ## For multi-col environments
  pdf_document:
    latex_engine: xelatex
    toc: true
    dev: cairo_pdf
    # fig_width: 7 ## Optional: Set default PDF figure width
    # fig_height: 6 ## Optional: Set default PDF figure height
    includes:
      in_header: preamble.tex ## For multi-col environments
    pandoc_args:
        --template=mytemplate.tex ## For affiliation field. See: https://bit.ly/2T191uZ
always_allow_html: true
urlcolor: blue
mainfont: cochineal
sansfont: Fira Sans
monofont: Fira Code ## Although, see: https://tex.stackexchange.com/q/294362
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE, dpi=300)
```

```{r, echo = FALSE, eval = TRUE, results = "hide"}
#Librerias
library(RCurl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggthemes)
library(psych)
```

Data (Por el momento estara cargada en este apartado).
```{r, echo = FALSE, eval = TRUE, results = "hide"}
data <- getURL("https://raw.githubusercontent.com/PabloFdezm/cademi/master/new_data.csv?token=AKX6XZNCMS255MOH7SZKJEK7MPYYG")
data <- read.csv(text= data, row.names = 1)
```

```{r, echo = FALSE, eval = TRUE}
knitr::kable(data) #Tabla Data
```

Revisar Recode -(Lanza errror de argumento al momento de copiarlo en Report.2.Rmd)-
```{r, echo = FALSE, eval = TRUE, results = "hide"}
### Recode: Psycafe 1, psycafe 3, psycafe 5, ts2.

data <- data %>%
  mutate(equipoID = as.factor(equipoID),
         psycsafe1 = 5 - (psycsafe1 -1),
         psycsafe3 = 5 - (psycsafe3 -1),
         psycsafe5 = 5 - (psycsafe5 -1),
         teamteamsatisfaction2 = 5 - (teamsatisfaction2 -1))

## Visualization

data %>%
  select(equipoID, starts_with("psy")) %>%
  mutate(equipoID = as.factor(equipoID))%>%
  pivot_longer(-equipoID)%>%
  ggplot()+
  geom_point(aes(x=equipoID,y=value, color=name))+
  facet_wrap(~name)+
  ggplot2::theme_classic()+
  theme(axis.text.x = element_text(angle = 45, size = 5))

## Alpha

# Psysafe data.
psysafe <- data %>%
  select(starts_with("psy"))

# loop

eliminacion <- 0

while ( is.na(eliminacion) == F ) {
  
  alfa <- alpha(psysafe)
  alfa_raw <- alfa$total$raw_alpha
  
  alfa_drop <- alfa$alpha.drop %>%
    as.data.frame()
  
  # Strategy
  eliminacion <- alfa_drop %>%
    select(raw_alpha)%>%
    filter(alfa_raw < raw_alpha)%>%
    row.names()%>%
    head(1)
  psysafe <- psysafe %>%
    select(-eliminacion)
  #
  
}

## Aggregation of psysafety

psysafety <- data %>%
  pivot_longer(-equipoID, names_to = "detail", values_to = "values")%>%
  transmute(equipoID, detail, values = if_else( grepl("psy", detail), values, 0))%>%
  filter(values != 0)%>%
  group_by(equipoID)%>%
  summarize(psysafety = round(mean(values),2))
```

aggregation strategy1
```{r, echo = FALSE, eval = TRUE, results = "hide"}
###################################### Psysafety #################################################

psysafe <- data %>%
  select(starts_with("psy"))
lim <- 0.8

eliminacion <- 0

while ( eliminacion < lim ) {
  
  alfa <- alpha(psysafe)
  alfa_raw <- alfa$total$raw_alpha
  
  alfa_drop <- alfa$alpha.drop %>%
    as.data.frame()
  
  # Strategy
  eliminacion <- alfa_drop %>%
    select(raw_alpha)%>%
    filter(alfa_raw < raw_alpha)%>%
    row.names()%>%
    head(1)
  psysafe <- psysafe %>%
    select(-eliminacion)
  #
  
}

psysafe_select <- colnames(psysafe)

psysafe <- data %>%
  select(equipoID, all_of(psysafe_select))%>%
  pivot_longer(-equipoID)%>%
  group_by(equipoID)%>%
  summarize(psysafe=round(mean(value),2))

###################################### Learn #################################################

learnb <- data %>%
  select(starts_with("learn"))

eliminacion <- 0

while ( eliminacion < lim ) {
  
  alfa <- alpha(learnb)
  alfa_raw <- alfa$total$raw_alpha
  
  alfa_drop <- alfa$alpha.drop %>%
    as.data.frame()
  
  # Strategy
  eliminacion <- alfa_drop %>%
    select(raw_alpha)%>%
    filter(alfa_raw < raw_alpha)%>%
    row.names()%>%
    head(1)
  learnb <- learnb %>%
    select(-eliminacion)
  #
  
}

learnb_select <- colnames(learnb)

learnb <- data %>%
  select(equipoID, all_of(learnb_select))%>%
  pivot_longer(-equipoID)%>%
  group_by(equipoID)%>%
  summarize(learnbehavior=round(mean(value),2))

###################################### Efficacy #################################################

efficacy <- data %>%
  select(starts_with("eff"))

eliminacion <- 0

while ( eliminacion < lim ) {
  
  alfa <- alpha(efficacy)
  alfa_raw <- alfa$total$raw_alpha
  
  alfa_drop <- alfa$alpha.drop %>%
    as.data.frame()
  
  # Strategy
  eliminacion <- alfa_drop %>%
    select(raw_alpha)%>%
    filter(alfa_raw < raw_alpha)%>%
    row.names()%>%
    head(1)
  efficacy <- efficacy %>%
    select(-eliminacion)
  #
  
}
efficacy_select <- colnames(efficacy)

efficacy <- data %>%
  select(equipoID, all_of(efficacy_select) )%>%
  pivot_longer(-equipoID)%>%
  group_by(equipoID)%>%
  summarize(efficacy=round(mean(value),2))

###################################### Team Satisfaction #################################################

team_s <- data %>%
  select(starts_with("team"))

eliminacion <- 0

while ( eliminacion < lim ) {
  
  alfa <- alpha(team_s)
  alfa_raw <- alfa$total$raw_alpha
  
  alfa_drop <- alfa$alpha.drop %>%
    as.data.frame()
  
  # Strategy
  eliminacion <- alfa_drop %>%
    select(raw_alpha)%>%
    filter(alfa_raw < raw_alpha)%>%
    row.names()%>%
    head(1)
  team_s <- team_s %>%
    select(-eliminacion)
  #
  
}
team_s_select <- colnames(team_s)

team_s <- data %>%
  select(equipoID, all_of(team_s_select) )%>%
  pivot_longer(-equipoID)%>%
  group_by(equipoID)%>%
  summarize(teamsatisfaction=round(mean(value),2))

###################################### Performance #################################################

performance <- data %>%
  select(equipoID, starts_with("per"))%>%
  pivot_longer(-equipoID)%>%
  group_by(equipoID)%>%
  summarize(performance=round(mean(value),2))


data_2 <- full_join(performance, psysafe)
data_2 <- full_join(data_2,team_s)
data_2 <- full_join(data_2,learnb)
data_2 <- full_join(data_2,efficacy)

model_1 <- lm(performance ~ learnbehavior, data_2)
summary(model_1)

model_2 <- lm(performance ~ psysafe, data_2)
summary(model_2)

model_3 <- lm(performance ~ efficacy, data_2)
summary(model_3)
```


## Abstract / Resumen.
#### (Keywords).

## Methods.

Para poner a prueba las hipotesis evaluadas en este trabajo, seguimos la metodologia de Edmonson (1999). El objetivo principal fue medir seguridad psicologica en los distintos grupos, analizar y comparar las variables independientes y dependientes y comprobar su relacion entre estos *(conocimiento, comportamiento de aprendizaje, eficacia y satisfaccion de equipo)*.

Estudiamos el proceso entre los estudiantes de primer año de la carrera de *Ingenieria Comercial* del año 2020, de la *Universidad Diego Portales*. Medimos datos cuantitativos en cuanto al curso de *Fundamentos de Administracion y Negocios*. Las encuestas fueron realizadas durante un lapso de 5 meses, en distintos periodos de tiempo. Estas se realizaron a traves de los docentes del curso, los cuales nos ayudaron tambien a la confeccion de las escalas y tipos de medidas. El total de estudiantes evaluados fue de 280 aproximadamente. Desde un inicio se trabajo en grupos pequeños de 5 a 6 estudiantes. Se recopilaron 48 equipos en total, los cuales fueron evaluados en conjunto durante todo el proceso, sin ninguna modificacion o salida de alguno de estos a lo largo del periodo establecido.

Al ser un curso de primer año universitario, nadie tenia conocimientos teoricos previos en cuanto a trabajo en equipo, liderazgo o administracion. Ademas, recalcar que ninguno de los estudiantes mantenia una relacion estrecha entre sus pares o academicos de la facultad, previa la investigacion realizada. El unico medio de interaccion que tuvimos con los estudiantes a lo largo del proyecto fueron netamente las respuestas otorgadas a traves de las encuestas.

-(¿Hay alguna libreria que nos ayude a corregir las reglas gramaticales en español?)-
-P: Ni idea, en cuantos más estas acostumbrado a la literatura academica, más sueles redactar como academico.-


### Process

Analizamos detalladamente el trabajo realizado por -Amy-(Nunca el nombre) Edmonson (1999) -(siempre el año)-, durate un periodo de 5 meses. Mientras se realizaba este proceso, se efectuo tambien la recopilacion de datos a travez de las encuestas realizadas a los estudiantes.

Lo primero fue evaluar las hipotesis a comprobar dentro del proyecto (H1, H2 y H3) -(Insertar referencia a la tabla con las hipotesis)-. Para ello, se diseñaron ciertas preguntas con ayuda de los docentes, acorde a las escalas ya antes previstas -(Insertar referencia a la tabla con las preguntas)-. De esta forma, los alumnos fueron encuentados a lo largo del tiempo establecido, 5 meses (t). En total se realizaron 3 periodos de encuestas que contenian este tipo de preguntas-(nose si queda claro)-.


### Measurements

Alfa de Chronbach e intercorrelaciones entre las variables de las encuestas a nivel de grupo. -(¿Lo dejamos?)-. -(variables que se separaron en el Alfa de Chronbach)-

<CENTER>Alfa de Chronbach. (Tabla)

<CENTER>Analisis de Varianza y Coeficientes de correlacion. (Tabla)
```{r, echo = FALSE, eval = TRUE}
#Correlaciones

cor(data)%>%
  ggcorrplot::ggcorrplot(hc.order = TRUE, 
                         type = "lower", 
                         lab = TRUE, 
                         lab_size = 2, 
                         method="circle", 
                         colors = c("tomato2", "white", "springgreen3"), 
                         title="Correlaciones", 
                         ggtheme=theme_bw)

knitr::kable(cor(data)) #Tabla Correlaciones

```


## Results.

## Discussion.

## Conclusion.

## References.
